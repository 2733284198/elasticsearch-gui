/*! elasticsearch-gui - v2.0.0 - 2015-11-04
* https://github.com/jettro/elasticsearch-gui
* Copyright (c) 2015 ; Licensed  */

var myApp=angular.module("myApp",["ngRoute","myApp.filters","myApp.services","myApp.directives","myApp.controllers","ui.bootstrap","elasticsearch","gridshore.c3js.chart"]).config(["$routeProvider",function(a){a.when("/dashboard",{templateUrl:"partials/dashboard.html",controller:"DashboardCtrl"}),a.when("/node/:nodeId",{templateUrl:"partials/node.html",controller:"NodeInfoCtrl"}),a.when("/search",{templateUrl:"partials/search.html",controller:"SearchCtrl"}),a.when("/query",{templateUrl:"partials/query.html",controller:"QueryCtrl"}),a.when("/inspect",{templateUrl:"partials/inspect.html",controller:"InspectCtrl"}),a.when("/inspect/:index/:id",{templateUrl:"partials/inspect.html",controller:"InspectCtrl"}),a.when("/graph",{templateUrl:"partials/graph.html",controller:"GraphCtrl"}),a.when("/tools/suggestions",{templateUrl:"partials/suggestions.html",controller:"SuggestionsCtrl"}),a.when("/tools/whereareshards",{templateUrl:"partials/whereareshards.html",controller:"WhereShardsCtrl"}),a.when("/tools/snapshots",{templateUrl:"partials/snapshots.html",controller:"SnapshotsCtrl"}),a.when("/about",{templateUrl:"partials/about.html"}),a.otherwise({redirectTo:"/dashboard"})}]);myApp.value("localStorage",window.localStorage),myApp.factory("$exceptionHandler",["$injector",function(a){return function(b,c){console.log(b);var d=a.get("errorHandling");throw d.add(b.message),b}}]);var serviceModule=angular.module("myApp.services",[]);serviceModule.value("version","2.0.0");var controllerModule=angular.module("myApp.controllers",[]);controllerModule.controller("AggregateDialogCtrl",["$scope","$modalInstance","fields",function(a,b,c){a.fields=c,a.aggsTypes=["Term","Range","Histogram","DateHistogram"],a.ranges=[],a.intervals=["year","month","week","day","hour","minute"],a.close=function(c){var d={};d.field=c.field,d.name=c.name,"Term"===c.aggstype?d.aggsType="term":"Range"===c.aggstype?(d.aggsType="range",d.ranges=a.ranges):"DateHistogram"===c.aggstype?(d.aggsType="datehistogram",d.interval=c.interval):"Histogram"===c.aggstype&&(d.aggsType="histogram",d.interval=c.interval),b.close(d)},a.addRangeField=function(b){a.ranges.push([b.range.from,b.range.to])}}]),controllerModule.controller("ChangeNumReplicasCtrl",["$scope","$modalInstance","indexService",function(a,b,c){a.dialog={numReplicas:c.numReplicas,name:c.name},a.close=function(a){b.close(a)}}]),controllerModule.controller("ConfigDialogCtrl",["$scope","$modalInstance","configuration",function(a,b,c){a.configuration=c,a.close=function(c){b.close(a.configuration)}}]),controllerModule.controller("CreateSnapshotCtrl",["$scope","$modalInstance",function(a,b){a.dialog={includeGlobalState:!0,ignoreUnavailable:!1},a.close=function(a){b.close(a)}}]),controllerModule.controller("CreateSnapshotRepositoryCtrl",["$scope","$modalInstance",function(a,b){a.dialog={},a.close=function(a){b.close(a)}}]),controllerModule.controller("DashboardCtrl",["$scope","elastic","$modal","indexService",function(a,b,c,d){function e(){b.indexesDetails(function(b){a.indices=b})}function f(){a.serverUrl=b.obtainServerAddress(),b.clusterHealth(function(b){a.health=b}),b.clusterNodes(function(b){a.nodes=b})}a.health={},a.nodes=[],a.plugins=[],a.serverUrl="",a.removeIndex=function(a){b.removeIndex(a,function(){e()})},a.openIndex=function(a){b.openIndex(a,function(){e()})},a.closeIndex=function(a){b.closeIndex(a,function(){e()})},a.openChangeReplicas=function(a){d.name=a.name,!isNaN(parseInt(a.numReplicas))&&isFinite(a.numReplicas)&&(d.numReplicas=parseInt(a.numReplicas));var f={backdrop:!0,keyboard:!0,backdropClick:!0,templateUrl:"template/dialog/numreplicas.html",controller:"ChangeNumReplicasCtrl",resolve:{fields:function(){return angular.copy(d)}}},g=c.open(f);g.result.then(function(a){a&&b.changeReplicas(a.name,a.numReplicas,function(){e()})},function(){})},a.$on("$viewContentLoaded",function(){e(),f()})}]),controllerModule.controller("GraphCtrl",["$scope","$modal","elastic","aggregateBuilder",function(a,b,c,d){function e(){var b={};b.index="",b.body={},b.size=0,b.body.query={matchAll:{}};var c=[];return c.push(a.aggregate),b.body.aggs=d.build(c),b}a.indices=[],a.types=[],a.fields=[],a.results=[],a.columns=[],a.loadIndices=function(){c.indexes(function(b){a.indices=b})},a.loadTypes=function(){c.types([],function(b){a.types=b})},a.loadFields=function(){c.fields([],[],function(b){a.fields=b})},a.openDialog=function(){var c={backdrop:!0,keyboard:!0,backdropClick:!0,templateUrl:"template/dialog/aggregate.html",controller:"AggregateDialogCtrl",resolve:{fields:function(){return angular.copy(a.fields)}}},d=b.open(c);d.result.then(function(b){b&&(a.aggregate=b,a.executeQuery())})},a.executeQuery=function(){var b=e();c.doSearch(b,function(b){if("term"===a.aggregate.aggsType){a.columns=[];var c={};angular.forEach(b.aggregations[a.aggregate.name].buckets,function(b){a.columns.push({id:b.key,type:"pie",name:b.key+"["+b.doc_count+"]"}),c[b.key]=b.doc_count}),a.results=[c]}else"datehistogram"===a.aggregate.aggsType?(a.columns=[{id:"doc_count",type:"line",name:"documents"}],a.xaxis={id:"key"},a.results=b.aggregations[a.aggregate.name].buckets):(a.columns=[{id:"doc_count",type:"bar",name:"documents"}],a.xaxis={id:"key"},a.results=b.aggregations[a.aggregate.name].buckets)},function(a){console.log(a)})},a.loadIndices(),a.loadTypes(),a.loadFields()}]),controllerModule.controller("InspectCtrl",["$scope","$routeParams","$location","elastic",function(a,b,c,d){a.inspect={},a.inspect.index="",a.inspect.id="",a.sourcedata={},a.sourcedata.indices=[],b.id&&(a.inspect.id=b.id),a.doInspect=function(){c.path("/inspect/"+a.inspect.index.name+"/"+a.inspect.id)},a.loadIndices=function(){d.indexes(function(c){if(c)for(var d=0;d<c.length;d++)a.sourcedata.indices[d]={name:c[d]},b.index&&b.index==c[d]&&(a.inspect.index=a.sourcedata.indices[d]);else a.sourcedata.indices=[]})},a.loadIndices()}]),controllerModule.controller("NavbarCtrl",["$scope","$timeout","$modal","elastic","configuration",function(a,b,c,d,e){function f(){d.clusterStatus(function(b,c){a.statusCluster.message=b,a.statusCluster.state=c}),b(function(){f()},5e3)}a.statusCluster={},a.serverUrl=d.obtainServerAddress(),a.configureServerUrl=!1,a.configure=e;var g=[];this.addItem=function(a){g.push(a)},this.select=a.select=function(a){angular.forEach(g,function(a){a.selected=!1}),a.selected=!0},this.selectByUrl=function(b){angular.forEach(g,function(c){c.link==b.split("/")[1]&&a.select(c)})},a.changeServerUrl=function(){d.changeServerAddress(a.serverUrl),e.excludedIndexes=a.configure.excludedIndexes},a.openDialog=function(){var a={backdrop:!0,keyboard:!0,backdropClick:!0,templateUrl:"template/dialog/config.html",controller:"ConfigDialogCtrl",resolve:{fields:function(){return angular.copy(e)}}},b=c.open(a);b.result.then(function(a){a&&(d.changeServerAddress(a.serverUrl),e=angular.copy(a))},function(){})},a.initNavBar=function(){f()},f()}]),controllerModule.controller("NodeInfoCtrl",["$scope","elastic","$routeParams",function(a,b,c){var d=c.nodeId;b.nodeInfo(d,function(b){a.nodes=b})}]),controllerModule.controller("NotificationCtrl",["$scope","$timeout",function(a,b){a.alerts={},a.$on("msg:notification",function(c,d,e){var f=Math.random().toString(36).substring(2,5);a.alerts[f]={type:d,message:e},b(function(){delete a.alerts[f]},1e4)})}]),controllerModule.controller("QueryCtrl",["$scope","$modal","elastic","aggregateBuilder","queryStorage",function(a,b,c,d,e){function f(){var b={};b.index="",b.body={},b.body.query={},b.size=a.pageSize,b.from=(a.currentPage-1)*a.pageSize;var c=[];angular.forEach(a.query.indices,function(a){a.state&&c.push(a.name)}),b.index=c.toString();var e=[];if(angular.forEach(a.query.types,function(a){a.state&&e.push(a.name)}),b.type=e.toString(),a.query.chosenFields.length>0&&(b.fields=a.query.chosenFields.toString()),a.query.multiSearch&&a.query.advanced.searchFields.length>0){for(var f={},j=0;j<a.query.advanced.searchFields.length;j++){var k=a.query.advanced.searchFields[j],l=a.fields[k.field];i(f,k.field,k.text,k.type),l.nestedPath&&h(f,l.nestedPath,l.nestedPath)}b.body.query=g(f)}else if(a.query.term.length>0){var m={};m.query=a.query.term,"phrase"===a.query.type?m.type="phrase":m.operator=a.query.type,b.body.query.match={_all:m}}else b.body.query.matchAll={};if(b.body.aggs=d.build(a.query.aggs),b.body.explain=a.query.explain,a.query.highlight){var n={fields:{}};angular.forEach(a.query.chosenFields,function(a){n.fields[a]={}}),b.body.highlight=n}return b}function g(b){var c=Object.getOwnPropertyNames(b),d={};d.bool={},d.bool.must=[];for(var e=0;e<c.length;e++){var f=c[e];if(b[f]instanceof Object)d.bool.must.push(g(b[f]));else if("_"!==f.substring(0,1)){var h=f;b._nested&&(h=b._nested+"."+h);var i={};i[h]={},i[h].query=b[f],"phrase"===a.query.type?i[h].type="phrase":(console.log(b[f]+"-"+b["_type_"+f]),i[h].operator=b["_type_"+f]),d.bool.must.push({match:i})}}var j;if(b._nested){var k={};k.nested={},k.nested.path=b._nested,k.nested.query=d,j=k}else j=d;return j}function h(a,b,c){var d=b.split(".");d.length>1?h(a[d[0]],d.splice(1).join("."),c):a[b]._nested=c}function i(a,b,c,d){var e=b.split(".");e.length>1?(a.hasOwnProperty(e[0])||(a[e[0]]={}),i(a[e[0]],e.splice(1).join("."),c,d)):a.hasOwnProperty(b)||(a[b]=c,a["_type_"+b]=d)}a.fields=[],a.createdQuery="",a.queryResults=[],a.aggsResults=[],a.metaResults={},a.queryFactory={},a.query={},a.query.chosenFields=[],a.query.aggs={},a.query.indices={},a.query.types={},a.query.advanced={},a.query.advanced.searchFields=[],a.query.advanced.newType="or",a.query.multiSearch=!1,a.currentPage=1,a.maxSize=5,a.numPages=0,a.pageSize=10,a.totalItems=0,a.$watchCollection("query",function(){a.changeQuery()}),a.changePage=function(){a.executeQuery()},a.restartSearch=function(){a.currentPage=1,a.numPages=0,a.pageSize=10,a.totalItems=0,a.executeQuery()},a.unbind={},a.unbind.indicesScope=function(){},a.unbind.typesScope=function(){},a.loadIndices=function(){a.unbind.indicesScope(),c.indexes(function(b){if(b){for(var c=0;c<b.length;c++)a.query.indices[b[c]]={name:b[c],state:!1};a.unbind.indicesScope=a.$watch("query.indices",a.loadTypes,!0)}else a.query.indices={}})},a.loadTypes=function(){a.query.types={};var b=[];angular.forEach(a.query.indices,function(a){a.state&&b.push(a.name)}),a.unbind.typesScope(),c.types(b,function(b){if(b){for(var c=0;c<b.length;c++)a.query.types[b[c]]={name:b[c],state:!1};a.unbind.typesScope=a.$watch("query.types",a.loadFields,!0)}else a.query.types={}})},a.loadFields=function(){var b=[];angular.forEach(a.query.indices,function(a){a.state&&b.push(a.name)});var d=[];angular.forEach(a.query.types,function(a){a.state&&d.push(a.name)}),c.fields(b,d,function(b){a.fields=b})},a.addQueryField=function(){var b=a.query.chosenFields.indexOf(a.queryFactory.addField);-1==b&&a.query.chosenFields.push(a.queryFactory.addField),a.changeQuery()},a.addAllQueryFields=function(){angular.forEach(a.fields,function(b,c){a.query.chosenFields.push(c)}),a.changeQuery()},a.removeQueryField=function(b){a.query.chosenFields.splice(b,1),a.changeQuery()},a.addSearchField=function(){var b={};b.field=a.query.advanced.newField,b.text=a.query.advanced.newText,b.type=a.query.advanced.newType,a.query.advanced.searchFields.push(b)},a.removeSearchField=function(b){a.query.advanced.searchFields.splice(b,1)},a.removeAggregateField=function(b){delete a.query.aggs[b],a.changeQuery()},a.executeQuery=function(){a.changeQuery();var b=f();a.metaResults={},c.doSearch(b,function(b){a.queryResults=b.hits,a.aggsResults=b.aggregations,a.numPages=Math.ceil(b.hits.total/a.pageSize),a.totalItems=b.hits.total,a.metaResults.totalShards=b._shards.total,b._shards.failed>0&&(a.metaResults.failedShards=b._shards.failed,a.metaResults.errors=[],angular.forEach(b._shards.failures,function(b){a.metaResults.errors.push(b.index+" - "+b.reason)}))},function(b){a.metaResults.failedShards=1,a.metaResults.errors=[],a.metaResults.errors.push(b.error)})},a.resetQuery=function(){a.loadIndices(),a.query.term="",a.query.chosenIndices=[],a.query.chosenTypes=[],a.query.chosenFields=[],a.query.advanced={},a.query.advanced.searchFields=[],a.query.advanced.newType="or",a.query.advanced.newText=null,a.query.advanced.newField=null,a.query.multiSearch=!1,a.changeQuery(),a.query.type="or"},a.changeQuery=function(){a.createdQuery=JSON.stringify(f().body,null,2)},a.openDialog=function(){var c={backdrop:!0,keyboard:!0,backdropClick:!0,templateUrl:"template/dialog/aggregate.html",controller:"AggregateDialogCtrl",resolve:{fields:function(){return angular.copy(a.fields)}}},d=b.open(c);d.result.then(function(b){b&&(a.query.aggs[b.name]=b,a.changeQuery())})},a.saveQuery=function(){e.saveQuery(angular.copy(a.query))},a.loadQuery=function(){e.loadQuery(function(b){a.query=angular.copy(b),a.changeQuery()})},this.errorCallback=function(a){console.log(a)},a.resetQuery()}]),controllerModule.controller("SearchCtrl",["$scope","elastic","configuration","aggregateBuilder","$modal","queryStorage",function(a,b,c,d,e,f){function g(){var b;if(a.search.doAdvanced&&a.search.advanced.searchFields.length>0){for(var c={},d=0;d<a.search.advanced.searchFields.length;d++){var e=a.search.advanced.searchFields[d],f=a.fields[e.field];j(c,e.field,e.text),f.nestedPath&&i(c,f.nestedPath,f.nestedPath)}b=h(c)}else b=a.search.simple&&a.search.simple.length>0?{simple_query_string:{query:a.search.simple,fields:["_all"],analyzer:"snowball"}}:{matchAll:{}};return b}function h(a){var b=Object.getOwnPropertyNames(a),c={};c.bool={},c.bool.must=[];for(var d=0;d<b.length;d++){var e=b[d];if(a[e]instanceof Object)c.bool.must.push(h(a[e]));else if("_"!==e.substring(0,1)){var f=e;a._nested&&(f=a._nested+"."+f);var g={};g[f]=a[e],c.bool.must.push({match:g})}}var i;if(a._nested){var j={};j.nested={},j.nested.path=a._nested,j.nested.query=c,i=j}else i=c;return i}function i(a,b,c){var d=b.split(".");d.length>1?i(a[d[0]],d.splice(1).join("."),c):a[b]._nested=c}function j(a,b,c){var d=b.split(".");d.length>1?(a.hasOwnProperty(d[0])||(a[d[0]]={}),j(a[d[0]],d.splice(1).join("."),c)):a.hasOwnProperty(b)||(a[b]=c)}function k(){if(a.search.selectedAggs&&a.search.selectedAggs.length>0){for(var b={},c=a.search.selectedAggs,d=[],e=0;e<c.length;e++){var f=a.search.aggs[c[e].key],g=f.aggsType;if("term"===g){var h={term:{}};h.term[a.search.aggs[c[e].key].field]=c[e].value,d.push(h)}else if("datehistogram"===g){var i=new Date(c[e].value);"year"===f.interval?i.setFullYear(i.getFullYear()+1):"month"===f.interval?i.setMonth(i.getMonth()+1):"week"===f.interval?i.setDate(i.getDate()+7):"day"===f.interval?i.setDate(i.getDate()+1):"hour"===f.interval?i.setHours(i.getHours()+1):"minute"===f.interval&&i.setMinutes(i.getMinutes()+1);var j={range:{}};j.range[a.search.aggs[c[e].key].field]={from:c[e].value,to:i.getTime()},d.push(j)}else if("histogram"===g){var j={range:{}},k=a.search.aggs[c[e].key];j.range[k.field]={from:c[e].value,to:c[e].value+k.interval-1},d.push(j)}else if("range"===g){var j={range:{}},k=a.search.aggs[c[e].key];j.range[k.field]={from:c[e].from,to:c[e].to},d.push(j)}}return b.and=d,b}return null}function l(b){a.metaResults.failedShards=1,a.metaResults.errors=[],b.message&&"object"==typeof b.message?b.message.hasOwnProperty("message")&&a.metaResults.errors.push(b.message.message):a.metaResults.errors.push(b.message)}a.isCollapsed=!0,a.configure=c,a.fields=[],a.search={},a.search.advanced={},a.search.advanced.searchFields=[],a.search.aggs={},a.search.selectedAggs=[],a.configError="",a.results=[],a.aggs=[],a.tokensPerField=[],a.currentPage=1,a.maxSize=5,a.numPages=0,a.pageSize=10,a.totalItems=0,a.changePage=function(){a.doSearch()},a.init=function(){b.fields([],[],function(b){a.fields=b,a.configure.title||a.fields.title&&(a.configure.title="title"),!a.configure.description&&a.fields.description&&(a.configure.description="description")})},a.restartSearch=function(){a.currentPage=1,a.numPages=0,a.pageSize=10,a.totalItems=0,a.tokensPerField=[],a.doSearch()},a.doSearch=function(){a.configure.title&&a.configure.description?a.configError="":a.configError="Please configure the title and description in the configuration at the top of the page.";var c={};c.index="",c.body={},c.size=a.pageSize,c.from=(a.currentPage-1)*a.pageSize,c.body.aggs=d.build(a.search.aggs);var e=k();e?c.body.query={filtered:{query:g(),filter:e}}:c.body.query=g(),a.metaResults={},b.doSearch(c,function(b){a.results=b.hits,a.aggs=b.aggregations,a.numPages=Math.ceil(b.hits.total/a.pageSize),a.totalItems=b.hits.total,a.metaResults.totalShards=b._shards.total,b._shards.failed>0&&(a.metaResults.failedShards=b._shards.failed,a.metaResults.errors=[],angular.forEach(b._shards.failures,function(b){a.metaResults.errors.push(b.index+" - "+b.reason)}))},l)},a.addSearchField=function(){var b={};b.field=a.search.advanced.newField,b.text=a.search.advanced.newText,a.search.advanced.searchFields.push(b)},a.removeSearchField=function(b){a.search.advanced.searchFields.splice(b,1)},a.openDialog=function(){var b={backdrop:!0,keyboard:!0,backdropClick:!0,templateUrl:"template/dialog/aggregate.html",controller:"AggregateDialogCtrl",resolve:{fields:function(){return angular.copy(a.fields)}}},c=e.open(b);c.result.then(function(b){b&&(a.search.aggs[b.name]=b)},function(){})},a.removeAggregateField=function(b){delete a.search.aggs[b]},a.saveQuery=function(){f.saveSearch(angular.copy(a.search))},a.loadQuery=function(){f.loadSearch(function(b){a.search=angular.copy(b)})},a.addFilter=function(b,c){a.search.selectedAggs||(a.search.selectedAggs=[]),a.search.selectedAggs.push({key:b,value:c}),a.doSearch()},a.addRangeFilter=function(b,c,d){a.search.selectedAggs||(a.search.selectedAggs=[]),a.search.selectedAggs.push({key:b,from:c,to:d}),a.doSearch()},a.checkSelectedAggregate=function(b,c){if(!a.search.selectedAggs)return!1;for(var d=0;d<a.search.selectedAggs.length;d++){var e=a.search.selectedAggs;if(e[d].key===b&&e[d].value===c)return!0}return!1},a.checkSelectedRangeAggregate=function(b,c,d){if(!a.search.selectedAggs)return!1;for(var e=0;e<a.search.selectedAggs.length;e++){var f=a.search.selectedAggs;if(f[e].key===b&&f[e].from===c&&f[e].to===d)return!0}return!1},a.removeFilter=function(b,c){if(a.search.selectedAggs){for(var d=0;d<a.search.selectedAggs.length;d++){var e=a.search.selectedAggs;e[d].key===b&&e[d].value===c&&a.search.selectedAggs.splice(d,1)}a.doSearch()}},a.removeRangeFilter=function(b,c,d){if(a.search.selectedAggs){for(var e=0;e<a.search.selectedAggs.length;e++){var f=a.search.selectedAggs;f[e].key===b&&f[e].from===c&&f[e].to===d&&a.search.selectedAggs.splice(e,1)}a.doSearch()}},a.obtainAggregateByKey=function(b){for(var c=0;c<a.search.aggs.length;c++){var d=a.search.aggs[c];if(d.field===b)return d}return null},a.showAnalysis=function(c,d,e){a.tokensPerField={id:c+d+e},b.documentTerms(c,d,e,function(b){a.tokensPerField.tokens=b})}}]),controllerModule.controller("SnapshotsCtrl",["$scope","elastic","$modal",function(a,b,c){a.repositories=[],a.selectedRepository="",a.snapshots=[],a.snapshotsStatus=!1,a.$watch("selectedRepository",function(){a.listSnapshots()}),a.listRepositories=function(){b.snapshotRepositories(function(b){a.repositories=b})},a.selectRepository=function(b){a.selectedRepository=b},a.deleteRepository=function(c){b.deleteRepository(c,function(b){a.selectedRepository===c&&(a.selectedRepository=""),a.listRepositories()})},a.listSnapshots=function(){""!==a.selectedRepository&&b.obtainSnapshotStatus(function(c){c.length>0?(a.snapshotsStatus=!0,a.snapshots=c):b.obtainSnapshots(a.selectedRepository,function(b){a.snapshotsStatus=!1,a.snapshots=b})})},a.removeSnapshot=function(c){b.removeSnapshot(a.selectedRepository,c,function(){a.listSnapshots()})},a.removeSnapshotFromRepository=function(c,d){b.removeSnapshot(c,d,function(){a.listSnapshots()})},a.restoreSnapshot=function(c){b.restoreSnapshot(a.selectedRepository,c,function(){a.listSnapshots()})},a.openCreateSnapshot=function(){var d={backdrop:!0,keyboard:!0,backdropClick:!0,templateUrl:"template/dialog/createsnapshot.html",controller:"CreateSnapshotCtrl"},e=c.open(d);e.result.then(function(c){if(c){var d={};if(d.repository=a.selectedRepository,c.name)d.snapshot=c.name;else{var e=moment().format("YYYYMMDDHHmmss");d.snapshot=c.prefix+"-"+e}d.indices=c.indices,d.ignoreUnavailable=c.ignoreUnavailable,d.includeGlobalState=c.includeGlobalState,b.createSnapshot(d,function(){a.listSnapshots()})}},function(){})},a.openCreateSnapshotRepository=function(){var d={backdrop:!0,keyboard:!0,backdropClick:!0,templateUrl:"template/dialog/createsnapshotrepository.html",controller:"CreateSnapshotRepositoryCtrl"},e=c.open(d);e.result.then(function(c){c&&b.createRepository(c,function(){a.listRepositories(),a.selectedRepository=""})},function(){})},a.$on("$viewContentLoaded",function(){a.listRepositories()})}]),controllerModule.controller("SuggestionsCtrl",["$scope","elastic",function(a,b){a.suggest={},a.suggest.index="",a.suggest.field="",a.suggest.query="",a.suggest.min_word_length=3,a.suggest.prefix_length=1,a.sourcedata={},a.sourcedata.indices=[],a.sourcedata.fields=[],a.results={},a.unbind={},a.unbind.indicesScope=function(){},a.doSuggest=function(){var c={};c.index=a.suggest.index.name,c.field=a.suggest.field,c.query=a.suggest.query,c.min_word_length=a.suggest.min_word_length,c.prefix_length=a.suggest.prefix_length,b.suggest(c,function(b){a.results=b})},a.loadIndices=function(){a.unbind.indicesScope(),b.indexes(function(b){if(b){for(var c=0;c<b.length;c++)a.sourcedata.indices[c]={name:b[c]};a.unbind.indicesScope=a.$watch("suggest.index",a.loadFields,!0)}else a.sourcedata.indices=[],a.sourcedata.fields=[]})},a.loadFields=function(){var c=[];a.suggest.index&&c.push(a.suggest.index.name);var d=[];b.fields(c,d,function(b){a.sourcedata.fields=b})},a.loadIndices()}]),controllerModule.controller("WhereShardsCtrl",["$scope","$timeout","elastic",function(a,b,c){function d(){c.obtainShards(function(b,c){var d={};angular.forEach(c,function(a,b){angular.forEach(a.shards,function(a,c){angular.forEach(a,function(a){var c;c=a.primary?" (P)":" (R)",d[a.node]||(d[a.node]={}),d[a.node][b]||(d[a.node][b]=[]),d[a.node][b].push(a.shard+c)})})}),a.nodeInfo=b,a.shardsInfo=d}),b(function(){d()},5e3)}a.shardsInfo={},a.nodeInfo={},a.init=function(){d()}}]),angular.module("myApp.directives",["myApp.controllers"]).directive("appVersion",["version",function(a){return function(b,c,d){c.text(a)}}]).directive("navbar",["$location",function(a){return{restrict:"E",transclude:!0,scope:{heading:"@"},controller:"NavbarCtrl",templateUrl:"template/navbar/navbar.html",replace:!0,link:function(b,c,d,e){b.$location=a,b.$watch("$location.path()",function(a){e.selectByUrl(a)})}}}]).directive("navbaritem",[function(){return{require:"^navbar",restrict:"E",templateUrl:"template/navbar/navbaritem.html",replace:!0,scope:{theLink:"@link",theTitle:"@title"},link:function(a,b,c,d){a.item={title:c.title,link:c.link,selected:!1},d.addItem(a.item)}}}]).directive("navbardropdownitem",[function(){return{require:"^navbar",restrict:"E",scope:{theLink:"@link",theTitle:"@title"},templateUrl:"template/navbar/navbardropdownitem.html",replace:!0,link:function(a,b,c,d){}}}]).directive("navbardropdown",[function(){return{require:"^navbar",restrict:"E",transclude:!0,scope:{theTitle:"@title",theLink:"@link"},templateUrl:"template/navbar/navbardropdown.html",replace:!0,link:function(a,b,c,d){a.item={title:a.theTitle,link:a.theLink,selected:!1},d.addItem(a.item)}}}]).directive("ngConfirmClick",[function(){return{link:function(a,b,c){var d=c.ngConfirmClick||"Are you sure?",e=c.confirmedClick;b.bind("click",function(b){window.confirm(d)&&a.$eval(e)})}}}]),angular.module("myApp.filters",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]),serviceModule.factory("aggregateBuilder",function(){function a(){this.build=function(a){var b={};return angular.forEach(a,function(a,c){if("term"===a.aggsType)b[a.name]={terms:{field:a.field}};else if("range"===a.aggsType){for(var d=[],e=0;e<a.ranges.length;e++){var f=a.ranges[e];void 0==f[0]?d.push({to:f[1]}):void 0==f[1]?d.push({from:f[0]}):d.push({from:f[0],to:f[1]})}b[a.name]={range:{field:a.field,ranges:d}}}else"datehistogram"===a.aggsType?b[a.name]={date_histogram:{field:a.field,interval:a.interval}}:"histogram"===a.aggsType&&(b[a.name]={histogram:{field:a.field,interval:a.interval}})}),b}}return new a}),serviceModule.factory("configuration",["$rootScope","localStorage","$location",function(a,b,c){function d(b){var d,e="es-config",f=b[e];if(f)d=JSON.parse(f);else{var g;g="www.gridshore.nl"==c.host()?"http://localhost:9200":c.protocol()+"://"+c.host()+":"+c.port(),d={title:void 0,description:void 0,exludedIndexes:void 0,serverUrl:g}}return a.$watch(function(){return d},function(){b[e]=JSON.stringify(d)},!0),d}return new d(b)}]),serviceModule.factory("elastic",["esFactory","configuration","$q","$rootScope",function(a,b,c,d){function e(a,b,c,d){function e(a,b,c,d){if(a.hasOwnProperty("properties")){var f="nested"==a.type|"object"==a.type;f&&(d=b);for(var g in a.properties){var h=b+"."+g;e(a.properties[g],h,c,d)}}else{if(a.hasOwnProperty("fields"))for(var i in a.fields){var j=b+"."+i;c[j]||b===i||(c[j]=a.fields[i],c[j].nestedPath=d,c[j].forPrint=j+" ("+a.type+")")}c[b]||(c[b]=a,c[b].nestedPath=d,c[b].type=a.type,c[b].forPrint=b+" ("+a.type+")")}}function f(){return a({host:h,apiVersion:"2.0"})}function g(a){var c=!1;if(b.includedIndexes&&b.includedIndexes.length>0){c=!0;var d=b.includedIndexes?b.includedIndexes.split(","):[];angular.forEach(d,function(b){var d=b.trim();a.substring(0,d.length)===d&&(c=!1)})}else{var e=b.excludedIndexes?b.excludedIndexes.split(","):[];angular.forEach(e,function(b){var d=b.trim();a.substring(0,d.length)===d&&(c=!0)})}return!c}var h=b.serverUrl,i={green:"success",yellow:"warning",red:"error"},j=f(),k=[];this.changeServerAddress=function(a){h=a,j=f(),this.indexes()},this.obtainServerAddress=function(){return h},this.clusterStatus=function(a){j.cluster.health({}).then(function(b){var c=b.number_of_nodes-b.number_of_data_nodes,d=b.cluster_name+" [nodes: "+b.number_of_nodes+", clients: "+c+"]";a(d,i[b.status])},function(b){a("No connection","error")})},this.clusterHealth=function(a){j.cluster.health().then(function(b){a(b)})},this.clusterNodes=function(a){j.nodes.info().then(function(b){a(b.nodes)})},this.obtainShards=function(a){j.cluster.state({metric:["routing_table","nodes"]}).then(function(b){a(b.nodes,b.routing_table.indices)})},this.nodeInfo=function(a,b){j.nodes.info({nodeId:a,human:!0}).then(function(c){b(c.nodes[a])})},this.indexes=function(a){j.cluster.state({ignoreUnavailable:!0}).then(function(b){var c=[];for(var d in b.metadata.indices){g(d);g(d)&&c.push(d)}k=c,a&&a(c)})},this.removeIndex=function(a,b){j.indices["delete"]({index:a}).then(function(a){b()})},this.openIndex=function(a,b){j.indices.open({index:a}).then(function(a){b()})},this.closeIndex=function(a,b){j.indices.close({index:a}).then(function(a){b()})},this.indexesDetails=function(a){j.indices.stats({human:!0,recovery:!1}).then(function(b){var c=b.indices;j.cluster.state({metric:"metadata"}).then(function(b){var d=b.metadata.indices,e=[];angular.forEach(d,function(a,b){var d={};d.name=b,"open"===a.state?(c[b]?(d.size=c[b].total.store.size,d.numDocs=c[b].total.docs.count):(d.size="unknown",d.numDocs="unknown"),d.state=!0,d.numShards=a.settings.index.number_of_shards,d.numReplicas=a.settings.index.number_of_replicas):d.state=!1,e.push(d)}),a(e)})})},this.types=function(a,b){var c={};a.length>0&&(c.index=a.toString()),j.indices.getMapping(c).then(function(a){var c=[];for(var d in a)if(g(d))for(var e in a[d].mappings)-1==c.indexOf(e)&&"_default_"!=e&&c.push(e);b(c)})},this.documentTerms=function(a,b,c,d){j.termvectors({index:a,type:b,id:c,routing:c,body:{fields:["*"],field_statistics:!1,term_statistics:!0}}).then(function(a){var b={};a.term_vectors&&(angular.forEach(a.term_vectors,function(a,c){var d=[];angular.forEach(a.terms,function(a,b){d.push(b)}),b[c]=d}),d(b))})},this.fields=function(a,b,c){var d={};a.length>0&&(d.index=a.toString()),b.length>0&&(d.type=b.toString()),j.indices.getMapping(d).then(function(a){var b=[],d={};for(var f in a)if(g(f))for(var h in a[f].mappings)if(-1==b.indexOf(h)&&"_default_"!=h){b.push(h);var i=a[f].mappings[h].properties;for(var j in i)e(i[j],j,d,void 0)}c(d)})},this.changeReplicas=function(a,b,c){var d={index:a,body:{index:{number_of_replicas:b}}};j.indices.putSettings(d).then(function(a){c(a)},l)},this.snapshotRepositories=function(a){j.snapshot.getRepository().then(function(b){a(b)},l)},this.createRepository=function(a,b){var c={repository:a.repository,body:{type:"fs",settings:{location:a.location}}};j.snapshot.createRepository(c).then(function(a){b()},m)},this.deleteRepository=function(a,b){j.snapshot.deleteRepository({repository:a}).then(function(a){b()},m)},this.obtainSnapshots=function(a,b){j.snapshot.get({repository:a,snapshot:"_all"}).then(function(a){b(a.snapshots)},l)},this.obtainSnapshotStatus=function(a){j.snapshot.status().then(function(b){a(b.snapshots)},l)},this.removeSnapshot=function(a,b,c){j.snapshot["delete"]({repository:a,snapshot:b}).then(function(a){c()},l)},this.restoreSnapshot=function(a,b,c){j.snapshot.restore({repository:a,snapshot:b}).then(function(a){c()},m)},this.createSnapshot=function(a,b){var c={repository:a.repository,snapshot:a.snapshot,body:{indices:a.indices,ignore_unavailable:a.ignoreUnavailable,include_global_state:a.includeGlobalState}};j.snapshot.create(c).then(function(a){b()},l)},this.doSearch=function(a,b,c){""===a.index&&(a.index=k),j.search(a).then(function(a){b(a)},function(a){c(a)})},this.suggest=function(a,b){var c={};c.index=a.index,c.body={},c.body.mysuggester={},c.body.mysuggester.text=a.query,c.body.mysuggester.term={},c.body.mysuggester.term.field=a.field,c.body.mysuggester.term.min_word_length=a.min_word_length,c.body.mysuggester.term.prefix_length=a.prefix_length,j.suggest(c).then(function(a){var c={};if(a.mysuggester)for(var d=0;d<a.mysuggester.length;d++){var e=a.mysuggester[d];c[e.text]=[];for(var f=0;f<e.options.length;f++)c[e.text].push(e.options[f].text)}b(c)},l)};var l=function(a){console.log(a)},m=function(a){d.$broadcast("msg:notification","error",a.message)};this.indexes()}return new e(a,b,c,d)}]),serviceModule.factory("errorHandling",["$rootScope",function(a){function b(a){this.add=function(b){var c;b&&"object"==typeof b?b.hasOwnProperty("message")&&(c=b.message):c=b,a.$broadcast("msg:notification","error",c)}}return new b(a)}]),serviceModule.factory("indexService",[function(){function a(){this.name="unknown",this.numReplicas=0}return new a}]),serviceModule.factory("queryStorage",["localStorage",function(a){function b(a){var b="es-query",c="es-search";this.loadQuery=function(c){var d=a[b];c(JSON.parse(d))},this.saveQuery=function(c){a[b]=JSON.stringify(c)},this.loadSearch=function(b){var d=a[c];b(JSON.parse(d))},this.saveSearch=function(b){a[c]=JSON.stringify(b)}}return new b(a)}]),serviceModule.factory("serverConfig",["$location",function(a){function b(a){"www.gridshore.nl"==a.host()?this.host="http://localhost:9200":this.host=a.protocol()+"://"+a.host()+":"+a.port()}return new b(a)}]);
//# sourceMappingURL=elasticsearch-gui.min.js.map