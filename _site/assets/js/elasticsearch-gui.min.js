/*! elasticsearch-gui - v2.0.0 - 2015-11-12
* https://github.com/jettro/elasticsearch-gui
* Copyright (c) 2015 ; Licensed  */

!function(){"use strict";angular.module("guiapp.aggregatedialog",[])}(),function(){"use strict";var a=angular.module("guiapp",["ngRoute","guiapp.filters","guiapp.directives","ui.bootstrap","elasticsearch","gridshore.c3js.chart","guiapp.services","guiapp.dashboard","guiapp.navbar","guiapp.search","guiapp.aggregatedialog","guiapp.snapshot","guiapp.nodeinfo","guiapp.graph"]);a.config(["$routeProvider",function(a){a.when("/query",{templateUrl:"partials/query.html",controller:"QueryCtrl"}),a.when("/inspect",{templateUrl:"partials/inspect.html",controller:"InspectCtrl"}),a.when("/inspect/:index/:id",{templateUrl:"partials/inspect.html",controller:"InspectCtrl"}),a.when("/tools/suggestions",{templateUrl:"partials/suggestions.html",controller:"SuggestionsCtrl"}),a.when("/tools/whereareshards",{templateUrl:"partials/whereareshards.html",controller:"WhereShardsCtrl"}),a.when("/tools/monitoring",{templateUrl:"partials/monitoring.html",controller:"MonitoringCtrl"}),a.when("/about",{templateUrl:"partials/about.html"}),a.otherwise({redirectTo:"/dashboard"})}]),a.value("localStorage",window.localStorage)}(),function(){"use strict";angular.module("guiapp.dashboard",["guiapp.services","ngRoute"])}(),function(){"use strict";angular.module("guiapp.graph",["guiapp.services","ngRoute","guiapp.aggregatedialog"])}(),function(){"use strict";angular.module("guiapp.navbar",["guiapp.services"])}(),function(){"use strict";angular.module("guiapp.nodeinfo",["guiapp.services","ngRoute"])}(),function(){"use strict";angular.module("guiapp.search",["guiapp.services","ngRoute"])}(),function(){"use strict";var a=angular.module("guiapp.services",["elasticsearch"]);a.value("version","2.0.0")}(),function(){"use strict";angular.module("guiapp.snapshot",["guiapp.services","ngRoute"])}(),function(){"use strict";function a(){function a(a){var b={};return angular.forEach(a,function(a){if("term"===a.aggsType)b[a.name]={terms:{field:a.field}};else if("range"===a.aggsType){for(var c=[],d=0;d<a.ranges.length;d++){var e=a.ranges[d];c.push(void 0==e[0]?{to:e[1]}:void 0==e[1]?{from:e[0]}:{from:e[0],to:e[1]})}b[a.name]={range:{field:a.field,ranges:c}}}else"datehistogram"===a.aggsType?b[a.name]={date_histogram:{field:a.field,interval:a.interval}}:"histogram"===a.aggsType&&(b[a.name]={histogram:{field:a.field,interval:a.interval}})}),b}return{build:a}}angular.module("guiapp.services").factory("aggregateBuilder",a)}(),function(){"use strict";function a(a,b,c){function d(){var d=b[f];if(d)e(JSON.parse(d));else{var h;h="www.gridshore.nl"==c.host()?"http://localhost:9200":c.protocol()+"://"+c.host()+":"+c.port(),e({title:void 0,description:void 0,excludedIndexes:void 0,serverUrl:h})}a.$watch(function(){return g.configuration},function(){b[f]=JSON.stringify(g.configuration)},!0)}function e(a){g.configuration=a}var f="es-config",g={configuration:{},changeConfiguration:e};return d(),g}angular.module("guiapp.services").factory("configuration",a),a.$inject=["$rootScope","localStorage","$location"]}(),function(){"use strict";function a(a,b,c){function d(a){H=a,J=D(),j()}function e(a){J.cluster.health({}).then(function(b){var c=b.number_of_nodes-b.number_of_data_nodes,d=b.cluster_name+" [nodes: "+b.number_of_nodes+", clients: "+c+"]";a(d,I[b.status])},function(){a("No connection","error")})}function f(a){J.cluster.health().then(function(b){a(b)})}function g(a){J.nodes.info().then(function(b){a(b.nodes)})}function h(a){J.cluster.state({metric:["routing_table","nodes"]}).then(function(b){a(b.nodes,b.routing_table.indices)})}function i(a,b){J.nodes.info({nodeId:a,human:!0}).then(function(c){b(c.nodes[a])})}function j(a){J.cluster.state({ignoreUnavailable:!0}).then(function(b){var c=[];for(var d in b.metadata.indices){{E(d)}E(d)&&c.push(d)}K=c,a&&a(c)})}function k(a,b){J.indices["delete"]({index:a}).then(function(){b()})}function l(a,b){J.indices.open({index:a}).then(function(){b()})}function m(a,b){J.indices.close({index:a}).then(function(){b()})}function n(a){J.indices.stats({human:!0,recovery:!1}).then(function(b){var c=b.indices;J.cluster.state({metric:"metadata"}).then(function(b){var d=b.metadata.indices,e=[];angular.forEach(d,function(a,b){var d={};d.name=b,"open"===a.state?(c[b]?(d.size=c[b].total.store.size,d.numDocs=c[b].total.docs.count):(d.size="unknown",d.numDocs="unknown"),d.state=!0,d.numShards=a.settings.index.number_of_shards,d.numReplicas=a.settings.index.number_of_replicas):d.state=!1,e.push(d)}),a(e)})})}function o(a,b){var c={};a.length>0&&(c.index=a.toString()),J.indices.getMapping(c).then(function(a){var c=[];for(var d in a)if(E(d))for(var e in a[d].mappings)-1==c.indexOf(e)&&"_default_"!=e&&c.push(e);b(c)})}function p(a,b,c,d){J.termvectors({index:a,type:b,id:c,routing:c,body:{fields:["*"],field_statistics:!1,term_statistics:!0}}).then(function(a){var b={};a.term_vectors&&(angular.forEach(a.term_vectors,function(a,c){var d=[];angular.forEach(a.terms,function(a,b){d.push(b)}),b[c]=d}),d(b))})}function q(a,b,c){var d={};a.length>0&&(d.index=a.toString()),b.length>0&&(d.type=b.toString()),J.indices.getMapping(d).then(function(a){var b=[],d={};for(var e in a)if(E(e))for(var f in a[e].mappings)if(-1==b.indexOf(f)&&"_default_"!=f){b.push(f);var g=a[e].mappings[f].properties;for(var h in g)A(g[h],h,d,void 0)}c(d)})}function r(a,b,c){var d={index:a,body:{index:{number_of_replicas:b}}};J.indices.putSettings(d).then(function(a){c(a)},F)}function s(a){J.snapshot.getRepository().then(function(b){a(b)},F)}function t(a,b){var c={repository:a.repository,body:{type:"fs",settings:{location:a.location}}};J.snapshot.createRepository(c).then(function(){b()},G)}function u(a,b){J.snapshot.deleteRepository({repository:a}).then(function(){b()},G)}function v(a,b){J.snapshot.get({repository:a,snapshot:"_all"}).then(function(a){b(a.snapshots)},F)}function w(a){J.snapshot.status().then(function(b){a(b.snapshots)},F)}function x(a,b,c){J.snapshot["delete"]({repository:a,snapshot:b}).then(function(){c()},F)}function y(a,b,c){J.snapshot.restore({repository:a,snapshot:b}).then(function(){c()},G)}function z(a,b){var c={repository:a.repository,snapshot:a.snapshot,body:{indices:a.indices,ignore_unavailable:a.ignoreUnavailable,include_global_state:a.includeGlobalState}};J.snapshot.create(c).then(function(){b()},F)}function A(a,b,c,d){if(a.hasOwnProperty("properties")){var e="nested"==a.type|"object"==a.type;e&&(d=b);for(var f in a.properties){var g=b+"."+f;A(a.properties[f],g,c,d)}}else{if(a.hasOwnProperty("fields"))for(var h in a.fields){var i=b+"."+h;c[i]||b===h||(c[i]=a.fields[h],c[i].nestedPath=d,c[i].forPrint=i+" ("+a.type+")")}c[b]||(c[b]=a,c[b].nestedPath=d,c[b].type=a.type,c[b].forPrint=b+" ("+a.type+")")}}function B(a,b,c){""===a.index&&(a.index=K),J.search(a).then(function(a){b(a)},function(a){c(a)})}function C(a,b){var c={};c.index=a.index,c.body={},c.body.mysuggester={},c.body.mysuggester.text=a.query,c.body.mysuggester.term={},c.body.mysuggester.term.field=a.field,c.body.mysuggester.term.min_word_length=a.min_word_length,c.body.mysuggester.term.prefix_length=a.prefix_length,J.suggest(c).then(function(a){var c={};if(a.mysuggester)for(var d=0;d<a.mysuggester.length;d++){var e=a.mysuggester[d];c[e.text]=[];for(var f=0;f<e.options.length;f++)c[e.text].push(e.options[f].text)}b(c)},F)}function D(){return a({host:H,apiVersion:"2.0"})}function E(a){var c=!1;if(b.includedIndexes&&b.includedIndexes.length>0){c=!0;var d=b.includedIndexes?b.includedIndexes.split(","):[];angular.forEach(d,function(b){var d=b.trim();a.substring(0,d.length)===d&&(c=!1)})}else{var e=b.excludedIndexes?b.excludedIndexes.split(","):[];angular.forEach(e,function(b){var d=b.trim();a.substring(0,d.length)===d&&(c=!0)})}return!c}function F(a){console.log(a)}function G(a){c.$broadcast("msg:notification","error",a.message)}var H=b.serverUrl,I={green:"success",yellow:"warning",red:"error"},J=D(),K=[],L={changeServerAddress:d,obtainServerAddress:function(){return H},clusterStatus:e,clusterHealth:f,clusterNodes:g,obtainShards:h,nodeInfo:i,indexes:j,removeIndex:k,openIndex:l,closeIndex:m,indexesDetails:n,types:o,documentTerms:p,fields:q,changeReplicas:r,snapshotRepositories:s,createRepository:t,deleteRepository:u,obtainSnapshots:v,obtainSnapshotStatus:w,removeSnapshot:x,restoreSnapshot:y,createSnapshot:z,doSearch:B,suggest:C};return L}angular.module("guiapp.services").factory("elastic",a),a.$inject=["esFactory","configuration","$rootScope"]}(),function(){"use strict";function a(a){function b(b){var c;b&&"object"==typeof b?b.hasOwnProperty("message")&&(c=b.message):c=b,a.$broadcast("msg:notification","error",c)}var c={add:b};return c}angular.module("guiapp.services").factory("errorHandling",a),a.$inject=["$rootScope"]}(),function(){"use strict";function a(){return{name:"unknown",numreplicas:0}}angular.module("guiapp.services").factory("indexService",a)}(),function(){"use strict";function a(a){function b(b){var c=a[f];b(JSON.parse(c))}function c(b){a[f]=JSON.stringify(b)}function d(b){var c=a[g];b(JSON.parse(c))}function e(b){a[g]=JSON.stringify(b)}var f="es-query",g="es-search",h={loadQuery:b,saveQuery:c,loadSearch:d,saveSearch:e};return h}angular.module("guiapp.services").factory("queryStorage",a),a.$inject=["localStorage"]}(),function(){"use strict";function a(a){function b(){c.host="www.gridshore.nl"==a.host()?"http://localhost:9200":a.protocol()+"://"+a.host()+":"+a.port()}var c={host:"",initHost:b};return c}angular.module("guiapp.services").factory("serverConfig",a),a.$inject=["$location"]}(),function(){"use strict";function a(a,b){function c(b){var c={};c.field=b.field,c.name=b.name,"Term"===b.aggstype?c.aggsType="term":"Range"===b.aggstype?(c.aggsType="range",c.ranges=e.ranges):"DateHistogram"===b.aggstype?(c.aggsType="datehistogram",c.interval=b.interval):"Histogram"===b.aggstype&&(c.aggsType="histogram",c.interval=b.interval),a.close(c)}function d(a){e.ranges.push([a.range.from,a.range.to])}var e=this;e.fields=b,e.aggsTypes=["Term","Range","Histogram","DateHistogram"],e.ranges=[],e.intervals=["year","month","week","day","hour","minute"],e.close=c,e.addRangeField=d}angular.module("guiapp.aggregatedialog").controller("AggregateDialogCtrl",a),a.$inject=["$modalInstance","fields"]}(),angular.module("guiapp").controller("InspectCtrl",["$scope","$routeParams","$location","elastic",function(a,b,c,d){if(a.inspect={},a.inspect.index="",a.inspect.id="",a.sourcedata={},a.sourcedata.indices=[],b.id&&b.index){a.inspect.id=b.id;var e={index:b.index,body:{query:{match:{_id:b.id}}},size:1};d.doSearch(e,function(b){a.result=b.hits.hits[0]},function(b){a.metaResults.failedShards=1,a.metaResults.errors=[],a.metaResults.errors.push(b.error)})}a.doInspect=function(){c.path("/inspect/"+a.inspect.index.name+"/"+a.inspect.id)},a.loadIndices=function(){d.indexes(function(c){if(c)for(var d=0;d<c.length;d++)a.sourcedata.indices[d]={name:c[d]},b.index&&b.index==c[d]&&(a.inspect.index=a.sourcedata.indices[d]);else a.sourcedata.indices=[]})},a.loadIndices()}]),angular.module("guiapp").controller("MonitoringCtrl",["$scope","elastic","$interval",function(a,b,c){a.dataNodes=[],a.columnsNodes=[{id:"num-nodes",type:"line",name:"Number of nodes"}],a.datax={id:"x"},a.dataShards=[],a.columnsShards=[{id:"num-shards-primary",type:"line",name:"Primary"},{id:"num-shards-active",type:"line",name:"Active"},{id:"num-shards-relocating",type:"line",name:"Relocating"},{id:"num-shards-initializing",type:"line",name:"Initializing"},{id:"num-shards-unassigned",type:"line",name:"Unassigned"}],a.dataxShards={id:"xShards"},a.numPoints=10,a.lengthDelay=5e3;var d;a.loadNodes=function(){d=c(function(){b.clusterNodes(function(b){a.dataNodes.length>=a.numPoints&&(a.dataNodes=a.dataNodes.splice(1,a.numPoints)),a.dataNodes.push({x:new Date,"num-nodes":Object.keys(b).length})}),b.clusterHealth(function(b){a.dataShards.length>=a.numPoints&&(a.dataShards=a.dataShards.splice(1,a.numPoints)),a.dataShards.push({xShards:new Date,"num-shards-primary":b.active_primary_shards,"num-shards-active":b.active_shards,"num-shards-relocating":b.relocating_shards,"num-shards-initializing":b.initializing_shards,"num-shards-unassigned":b.unassigned_shards})})},a.lengthDelay)},a.loadNodes()}]),angular.module("guiapp").controller("NotificationCtrl",["$scope","$timeout",function(a,b){a.alerts={},a.$on("msg:notification",function(c,d,e){var f=Math.random().toString(36).substring(2,5);a.alerts[f]={type:d,message:e},b(function(){delete a.alerts[f]},1e4)})}]),angular.module("guiapp").controller("QueryCtrl",["$scope","$modal","$location","elastic","aggregateBuilder","queryStorage",function(a,b,c,d,e,f){function g(){var b={};b.index="",b.body={},b.body.query={},b.size=a.pageSize,b.from=(a.currentPage-1)*a.pageSize;var c=[];angular.forEach(a.query.indices,function(a){a.state&&c.push(a.name)}),b.index=c.toString();var d=[];if(angular.forEach(a.query.types,function(a){a.state&&d.push(a.name)}),b.type=d.toString(),a.query.chosenFields.length>0&&(b.fields=a.query.chosenFields.toString()),a.query.multiSearch&&a.query.advanced.searchFields.length>0){for(var f={},g=0;g<a.query.advanced.searchFields.length;g++){var k=a.query.advanced.searchFields[g],l=a.fields[k.field];j(f,k.field,k.text,k.type),l.nestedPath&&i(f,l.nestedPath,l.nestedPath)}b.body.query=h(f)}else if(a.query.term.length>0){var m={};m.query=a.query.term,"phrase"===a.query.type?m.type="phrase":m.operator=a.query.type,b.body.query.match={_all:m}}else b.body.query.matchAll={};if(b.body.aggs=e.build(a.query.aggs),b.body.explain=a.query.explain,a.query.highlight){var n={fields:{}};angular.forEach(a.query.chosenFields,function(a){n.fields[a]={}}),b.body.highlight=n}return b}function h(b){var c=Object.getOwnPropertyNames(b),d={};d.bool={},d.bool.must=[];for(var e=0;e<c.length;e++){var f=c[e];if(b[f]instanceof Object)d.bool.must.push(h(b[f]));else if("_"!==f.substring(0,1)){var g=f;b._nested&&(g=b._nested+"."+g);var i={};i[g]={},i[g].query=b[f],"phrase"===a.query.type?i[g].type="phrase":(console.log(b[f]+"-"+b["_type_"+f]),i[g].operator=b["_type_"+f]),d.bool.must.push({match:i})}}var j;if(b._nested){var k={};k.nested={},k.nested.path=b._nested,k.nested.query=d,j=k}else j=d;return j}function i(a,b,c){var d=b.split(".");d.length>1?i(a[d[0]],d.splice(1).join("."),c):a[b]._nested=c}function j(a,b,c,d){var e=b.split(".");e.length>1?(a.hasOwnProperty(e[0])||(a[e[0]]={}),j(a[e[0]],e.splice(1).join("."),c,d)):a.hasOwnProperty(b)||(a[b]=c,a["_type_"+b]=d)}a.fields=[],a.createdQuery="",a.queryResults=[],a.aggsResults=[],a.metaResults={},a.queryFactory={},a.query={},a.query.chosenFields=[],a.query.aggs={},a.query.indices={},a.query.types={},a.query.advanced={},a.query.advanced.searchFields=[],a.query.advanced.newType="or",a.query.multiSearch=!1,a.currentPage=1,a.maxSize=5,a.numPages=0,a.pageSize=10,a.totalItems=0,a.$watchCollection("query",function(){a.changeQuery()}),a.changePage=function(){a.executeQuery()},a.restartSearch=function(){a.currentPage=1,a.numPages=0,a.pageSize=10,a.totalItems=0,a.executeQuery()},a.unbind={},a.unbind.indicesScope=function(){},a.unbind.typesScope=function(){},a.loadIndices=function(){a.unbind.indicesScope(),d.indexes(function(b){if(b){for(var c=0;c<b.length;c++)a.query.indices[b[c]]={name:b[c],state:!1};a.unbind.indicesScope=a.$watch("query.indices",a.loadTypes,!0)}else a.query.indices={}})},a.loadTypes=function(){a.query.types={};var b=[];angular.forEach(a.query.indices,function(a){a.state&&b.push(a.name)}),a.unbind.typesScope(),d.types(b,function(b){if(b){for(var c=0;c<b.length;c++)a.query.types[b[c]]={name:b[c],state:!1};a.unbind.typesScope=a.$watch("query.types",a.loadFields,!0)}else a.query.types={}})},a.loadFields=function(){var b=[];angular.forEach(a.query.indices,function(a){a.state&&b.push(a.name)});var c=[];angular.forEach(a.query.types,function(a){a.state&&c.push(a.name)}),d.fields(b,c,function(b){a.fields=b})},a.addQueryField=function(){var b=a.query.chosenFields.indexOf(a.queryFactory.addField);-1==b&&a.query.chosenFields.push(a.queryFactory.addField),a.changeQuery()},a.addAllQueryFields=function(){angular.forEach(a.fields,function(b,c){a.query.chosenFields.push(c)}),a.changeQuery()},a.removeQueryField=function(b){a.query.chosenFields.splice(b,1),a.changeQuery()},a.addSearchField=function(){var b={};b.field=a.query.advanced.newField,b.text=a.query.advanced.newText,b.type=a.query.advanced.newType,a.query.advanced.searchFields.push(b)},a.removeSearchField=function(b){a.query.advanced.searchFields.splice(b,1)},a.removeAggregateField=function(b){delete a.query.aggs[b],a.changeQuery()},a.executeQuery=function(){a.changeQuery();var b=g();a.metaResults={},d.doSearch(b,function(b){a.queryResults=b.hits,a.aggsResults=b.aggregations,a.numPages=Math.ceil(b.hits.total/a.pageSize),a.totalItems=b.hits.total,a.metaResults.totalShards=b._shards.total,b._shards.failed>0&&(a.metaResults.failedShards=b._shards.failed,a.metaResults.errors=[],angular.forEach(b._shards.failures,function(b){a.metaResults.errors.push(b.index+" - "+b.reason)}))},function(b){a.metaResults.failedShards=1,a.metaResults.errors=[],a.metaResults.errors.push(b.error)})},a.resetQuery=function(){a.loadIndices(),a.query.term="",a.query.chosenIndices=[],a.query.chosenTypes=[],a.query.chosenFields=[],a.query.advanced={},a.query.advanced.searchFields=[],a.query.advanced.newType="or",a.query.advanced.newText=null,a.query.advanced.newField=null,a.query.multiSearch=!1,a.changeQuery(),a.query.type="or"},a.changeQuery=function(){a.createdQuery=JSON.stringify(g().body,null,2)},a.openDialog=function(){var c={backdrop:!0,keyboard:!0,backdropClick:!0,templateUrl:"template/dialog/aggregate.html",controller:"AggregateDialogCtrl",resolve:{fields:function(){return angular.copy(a.fields)}}},d=b.open(c);d.result.then(function(b){b&&(a.query.aggs[b.name]=b,a.changeQuery())})},a.saveQuery=function(){f.saveQuery(angular.copy(a.query))},a.loadQuery=function(){f.loadQuery(function(b){a.query=angular.copy(b),a.changeQuery()})},a.inspect=function(a){c.path("/inspect/"+a._index+"/"+a._id)},this.errorCallback=function(a){console.log(a)},a.resetQuery()}]),angular.module("guiapp").controller("SuggestionsCtrl",["$scope","elastic",function(a,b){a.suggest={},a.suggest.index="",a.suggest.field="",a.suggest.query="",a.suggest.min_word_length=3,a.suggest.prefix_length=1,a.sourcedata={},a.sourcedata.indices=[],a.sourcedata.fields=[],a.results={},a.unbind={},a.unbind.indicesScope=function(){},a.doSuggest=function(){var c={};c.index=a.suggest.index.name,c.field=a.suggest.field,c.query=a.suggest.query,c.min_word_length=a.suggest.min_word_length,c.prefix_length=a.suggest.prefix_length,b.suggest(c,function(b){a.results=b})},a.loadIndices=function(){a.unbind.indicesScope(),b.indexes(function(b){if(b){for(var c=0;c<b.length;c++)a.sourcedata.indices[c]={name:b[c]};a.unbind.indicesScope=a.$watch("suggest.index",a.loadFields,!0)}else a.sourcedata.indices=[],a.sourcedata.fields=[]})},a.loadFields=function(){var c=[];a.suggest.index&&c.push(a.suggest.index.name);var d=[];b.fields(c,d,function(b){a.sourcedata.fields=b})},a.loadIndices()}]),angular.module("guiapp").controller("WhereShardsCtrl",["$scope","$timeout","elastic",function(a,b,c){function d(){c.obtainShards(function(b,c){var d={};angular.forEach(c,function(a,b){angular.forEach(a.shards,function(a){angular.forEach(a,function(a){var c;c=a.primary?" (P)":" (R)",d[a.node]||(d[a.node]={}),d[a.node][b]||(d[a.node][b]=[]),d[a.node][b].push(a.shard+c)})})}),a.nodeInfo=b,a.shardsInfo=d}),b(function(){d()},5e3)}a.shardsInfo={},a.nodeInfo={},a.init=function(){d()}}]),function(){"use strict";function a(a,b){function c(b){a.close(b)}var d=this;d.dialog={numReplicas:b.numReplicas,name:b.name},d.close=c}angular.module("guiapp.dashboard").controller("ChangeNumReplicasCtrl",a),a.$inject=["$modalInstance","indexService"]}(),function(){"use strict";function a(a,b,c,d){function e(a){b.closeIndex(a,function(){i()})}function f(a){b.openIndex(a,function(){i()})}function g(a){d.name=a.name,!isNaN(parseInt(a.numReplicas))&&isFinite(a.numReplicas)&&(d.numReplicas=parseInt(a.numReplicas));var e={backdrop:!0,keyboard:!0,backdropClick:!0,templateUrl:"template/dialog/numreplicas.html",controller:"ChangeNumReplicasCtrl",controllerAs:"cnrVm",resolve:{fields:function(){return angular.copy(d)}}},f=c.open(e);f.result.then(function(a){a&&b.changeReplicas(a.name,a.numReplicas,function(){i()})},function(){})}function h(a){b.removeIndex(a,function(){i()})}function i(){b.indexesDetails(function(a){k.indices=a})}function j(){k.serverUrl=b.obtainServerAddress(),b.clusterHealth(function(a){k.health=a}),b.clusterNodes(function(a){k.nodes=a})}var k=this;k.health={},k.nodes=[],k.plugins=[],k.serverUrl="",k.closeIndex=e,k.openIndex=f,k.openChangeReplicas=g,k.removeIndex=h,a.$on("$viewContentLoaded",function(){i(),j()})}angular.module("guiapp.dashboard").controller("DashboardCtrl",a),a.$inject=["$scope","elastic","$modal","indexService"]}(),function(){"use strict";function a(a){a.when("/dashboard",{templateUrl:"/partials/dashboard.html",controller:"DashboardCtrl",controllerAs:"vm"})}angular.module("guiapp.dashboard").config(a),a.$inject=["$routeProvider"]}(),angular.module("guiapp.directives",[]).directive("appVersion",["version",function(a){return function(b,c){c.text(a)}}]).directive("ngConfirmClick",[function(){return{link:function(a,b,c){var d=c.ngConfirmClick||"Are you sure?",e=c.confirmedClick;b.bind("click",function(){window.confirm(d)&&a.$eval(e)})}}}]),function(){"use strict";function a(a){a.decorator("$exceptionHandler",b)}function b(a,b){return function(c,d){a(c,d);b.error(c.msg)}}angular.module("guiapp").config(a),a.$inject=["$provide"],b.$inject=["$delegate","$log"]}(),angular.module("guiapp.filters",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]),function(){"use strict";function a(a,b,c){function d(){e(),f(),g()}function e(){b.indexes(function(a){k.indices=a})}function f(){b.types([],function(a){k.types=a})}function g(){b.fields([],[],function(a){k.fields=a})}function h(){var b={backdrop:!0,keyboard:!0,backdropClick:!0,templateUrl:"template/dialog/aggregate.html",controller:"AggregateDialogCtrl",controllerAs:"adVm",resolve:{fields:function(){return angular.copy(k.fields)}}},c=a.open(b);c.result.then(function(a){a&&(k.aggregate=a,i())})}function i(){var a=j();b.doSearch(a,function(a){if("term"===k.aggregate.aggsType){k.columns=[];var b={};angular.forEach(a.aggregations[k.aggregate.name].buckets,function(a){k.columns.push({id:a.key,type:"pie",name:a.key+"["+a.doc_count+"]"}),b[a.key]=a.doc_count}),k.results=[b]}else"datehistogram"===k.aggregate.aggsType?(k.columns=[{id:"doc_count",type:"line",name:"documents"}],k.xaxis={id:"key"},k.results=a.aggregations[k.aggregate.name].buckets):(k.columns=[{id:"doc_count",type:"bar",name:"documents"}],k.xaxis={id:"key"},k.results=a.aggregations[k.aggregate.name].buckets)},function(a){console.log(a)})}function j(){var a={};a.index="",a.body={},a.size=0,a.body.query={matchAll:{}};var b=[];return b.push(k.aggregate),a.body.aggs=c.build(b),a}var k=this;k.indices=[],k.types=[],k.fields=[],k.results=[],k.columns=[],k.loadIndices=e,k.loadTypes=f(),k.loadFields=g,k.openDialog=h,k.executeQuery=i,d()}angular.module("guiapp").controller("GraphCtrl",a),a.$inject=["$modal","elastic","aggregateBuilder"]}(),function(){"use strict";function a(a){a.when("/graph",{templateUrl:"/partials/graph.html",controller:"GraphCtrl",controllerAs:"vm"})}angular.module("guiapp.graph").config(a),a.$inject=["$routeProvider"]}(),function(){"use strict";function a(a,b){function c(){a.close(d.configuration)}var d=this;d.configuration=b,d.close=c}angular.module("guiapp.navbar").controller("ConfigDialogCtrl",a),a.$inject=["$modalInstance","configuration"]}(),function(){"use strict";function a(a,b,c,d){function e(a){m.push(a)}function f(a){angular.forEach(m,function(a){a.selected=!1}),a.selected=!0}function g(a){angular.forEach(m,function(b){b.link==a.split("/")[1]&&f(b)})}function h(){c.changeServerAddress(l.serverUrl),d.excludedIndexes=l.configure.excludedIndexes}function i(){k()}function j(){var a={backdrop:!0,keyboard:!0,backdropClick:!0,templateUrl:"template/dialog/config.html",controller:"ConfigDialogCtrl",controllerAs:"confVm",resolve:{fields:function(){return angular.copy(d)}}},e=b.open(a);e.result.then(function(a){a&&(c.changeServerAddress(a.serverUrl),d=angular.copy(a))},function(){})}function k(){c.clusterStatus(function(a,b){l.statusCluster.message=a,l.statusCluster.state=b}),a(function(){k()},5e3)}var l=this;l.statusCluster={},l.serverUrl=c.obtainServerAddress(),l.configureServerUrl=!1,l.configure=d;var m=[];l.addItem=e,l.changeServerUrl=h,l.initNavbar=i,l.openDialog=j,l.select=f,l.selectByUrl=g,k()}angular.module("guiapp.navbar").controller("NavbarCtrl",a),a.$inject=["$timeout","$modal","elastic","configuration"]}(),function(){"use strict";angular.module("guiapp.navbar").directive("navbar",["$location",function(a){return{restrict:"E",transclude:!0,scope:{heading:"@"},controller:"NavbarCtrl",controllerAs:"vm",templateUrl:"template/navbar/navbar.html",replace:!0,link:function(b,c,d,e){b.$location=a,b.$watch("$location.path()",function(a){e.selectByUrl(a)})}}}]).directive("navbaritem",[function(){return{require:"^navbar",restrict:"E",templateUrl:"template/navbar/navbaritem.html",replace:!0,scope:{theLink:"@link",theTitle:"@title"},link:function(a,b,c,d){a.item={title:c.title,link:c.link,selected:!1},d.addItem(a.item)}}}]).directive("navbardropdownitem",[function(){return{require:"^navbar",restrict:"E",scope:{theLink:"@link",theTitle:"@title"},templateUrl:"template/navbar/navbardropdownitem.html",replace:!0,link:function(){}}}]).directive("navbardropdown",[function(){return{require:"^navbar",restrict:"E",transclude:!0,scope:{theTitle:"@title",theLink:"@link"},templateUrl:"template/navbar/navbardropdown.html",replace:!0,link:function(a,b,c,d){a.item={title:a.theTitle,link:a.theLink,selected:!1},d.addItem(a.item)}}}])}(),function(){"use strict";function a(a,b){function c(){a.nodeInfo(e,function(a){d.nodes=a})}var d=this,e=b.nodeId;c()}angular.module("guiapp.nodeinfo").controller("NodeInfoCtrl",a),a.$inject=["elastic","$routeParams"]}(),function(){"use strict";function a(a){a.when("/node/:nodeId",{templateUrl:"/partials/node.html",controller:"NodeInfoCtrl",controllerAs:"vm"})}angular.module("guiapp.nodeinfo").config(a),a.$inject=["$routeProvider"]}(),function(){"use strict";function a(a,b,c,d,e){function f(){D.doSearch()}function g(){a.fields([],[],function(a){D.fields=a,D.configure.title||D.fields.title&&(D.configure.title="title"),!D.configure.description&&D.fields.description&&(D.configure.description="description")})}function h(){D.currentPage=1,D.numPages=0,D.pageSize=10,D.totalItems=0,D.tokensPerField=[],D.doSearch()}function i(){D.configError=D.configure.title&&D.configure.description?"":"Please configure the title and description in the configuration at the top of the page.";var b={};b.index="",b.body={},b.size=D.pageSize,b.from=(D.currentPage-1)*D.pageSize,b.body.aggs=c.build(D.search.aggs);var d=B();b.body.query=d?{filtered:{query:x(),filter:d}}:x(),a.doSearch(b,function(a){D.results=a.hits,D.aggs=a.aggregations,D.numPages=Math.ceil(a.hits.total/D.pageSize),D.totalItems=a.hits.total,D.metaResults.totalShards=a._shards.total,a._shards.failed>0&&(D.metaResults.failedShards=a._shards.failed,D.metaResults.errors=[],angular.forEach(a._shards.failures,function(a){D.metaResults.errors.push(a.index+" - "+a.reason)}))},C)}function j(){var a={};a.field=D.search.advanced.newField,a.text=D.search.advanced.newText,D.search.advanced.searchFields.push(a)}function k(a){D.search.advanced.searchFields.splice(a,1)}function l(){var a={backdrop:!0,keyboard:!0,backdropClick:!0,templateUrl:"template/dialog/aggregate.html",controller:"AggregateDialogCtrl",controllerAs:"adVm",resolve:{fields:function(){return angular.copy(D.fields)}}},b=d.open(a);b.result.then(function(a){a&&(D.search.aggs[a.name]=a)},function(){})}function m(a){delete D.search.aggs[a]}function n(){e.saveSearch(angular.copy(D.search))}function o(){e.loadSearch(function(a){D.search=angular.copy(a)})}function p(a,b){D.search.selectedAggs||(D.search.selectedAggs=[]),D.search.selectedAggs.push({key:a,value:b}),D.doSearch()}function q(a,b,c){D.search.selectedAggs||(D.search.selectedAggs=[]),D.search.selectedAggs.push({key:a,from:b,to:c}),D.doSearch()}function r(a,b){if(!D.search.selectedAggs)return!1;for(var c=0;c<D.search.selectedAggs.length;c++){var d=D.search.selectedAggs;if(d[c].key===a&&d[c].value===b)return!0}return!1}function s(a,b,c){if(!D.search.selectedAggs)return!1;for(var d=0;d<D.search.selectedAggs.length;d++){var e=D.search.selectedAggs;if(e[d].key===a&&e[d].from===b&&e[d].to===c)return!0}return!1}function t(a,b){if(D.search.selectedAggs){for(var c=0;c<D.search.selectedAggs.length;c++){var d=D.search.selectedAggs;d[c].key===a&&d[c].value===b&&D.search.selectedAggs.splice(c,1)}D.doSearch()}}function u(a,b,c){if(D.search.selectedAggs){for(var d=0;d<D.search.selectedAggs.length;d++){var e=D.search.selectedAggs;e[d].key===a&&e[d].from===b&&e[d].to===c&&D.search.selectedAggs.splice(d,1)}D.doSearch()}}function v(a){for(var b=0;b<D.search.aggs.length;b++){var c=D.search.aggs[b];if(c.field===a)return c}return null}function w(b,c,d){D.tokensPerField={id:b+c+d},a.documentTerms(b,c,d,function(a){D.tokensPerField.tokens=a})}function x(){var a;if(D.search.doAdvanced&&D.search.advanced.searchFields.length>0){for(var b={},c=0;c<D.search.advanced.searchFields.length;c++){var d=D.search.advanced.searchFields[c],e=D.fields[d.field];A(b,d.field,d.text),e.nestedPath&&z(b,e.nestedPath,e.nestedPath)}a=y(b)}else a=D.search.simple&&D.search.simple.length>0?{simple_query_string:{query:D.search.simple,fields:["_all"],analyzer:"snowball"}}:{matchAll:{}};return a}function y(a){var b=Object.getOwnPropertyNames(a),c={};c.bool={},c.bool.must=[];for(var d=0;d<b.length;d++){var e=b[d];if(a[e]instanceof Object)c.bool.must.push(y(a[e]));else if("_"!==e.substring(0,1)){var f=e;a._nested&&(f=a._nested+"."+f);var g={};g[f]=a[e],c.bool.must.push({match:g})}}var h;if(a._nested){var i={};i.nested={},i.nested.path=a._nested,i.nested.query=c,h=i}else h=c;return h}function z(a,b,c){var d=b.split(".");d.length>1?z(a[d[0]],d.splice(1).join("."),c):a[b]._nested=c}function A(a,b,c){var d=b.split(".");d.length>1?(a.hasOwnProperty(d[0])||(a[d[0]]={}),A(a[d[0]],d.splice(1).join("."),c)):a.hasOwnProperty(b)||(a[b]=c)}function B(){if(D.search.selectedAggs&&D.search.selectedAggs.length>0){for(var a={},b=D.search.selectedAggs,c=[],d=0;d<b.length;d++){var e=D.search.aggs[b[d].key],f=e.aggsType;if("term"===f){var g={term:{}};g.term[D.search.aggs[b[d].key].field]=b[d].value,c.push(g)}else if("datehistogram"===f){var h=new Date(b[d].value);"year"===e.interval?h.setFullYear(h.getFullYear()+1):"month"===e.interval?h.setMonth(h.getMonth()+1):"week"===e.interval?h.setDate(h.getDate()+7):"day"===e.interval?h.setDate(h.getDate()+1):"hour"===e.interval?h.setHours(h.getHours()+1):"minute"===e.interval&&h.setMinutes(h.getMinutes()+1);var i={range:{}};i.range[D.search.aggs[b[d].key].field]={from:b[d].value,to:h.getTime()},c.push(i)}else if("histogram"===f){var i={range:{}},j=D.search.aggs[b[d].key];i.range[j.field]={from:b[d].value,to:b[d].value+j.interval-1},c.push(i)}else if("range"===f){var i={range:{}},j=D.search.aggs[b[d].key];i.range[j.field]={from:b[d].from,to:b[d].to},c.push(i)}}return a.and=c,a}return null}function C(a){D.metaResults.failedShards=1,D.metaResults.errors=[],a.message&&"object"==typeof a.message?a.message.hasOwnProperty("message")&&D.metaResults.errors.push(a.message.message):D.metaResults.errors.push(a.message)}var D=this;D.isCollapsed=!0,D.configure=b,D.fields=[],D.search={},D.search.advanced={},D.search.advanced.searchFields=[],D.search.aggs={},D.search.selectedAggs=[],D.configError="",D.results=[],D.aggs=[],D.tokensPerField=[],D.metaResults={},D.currentPage=1,D.maxSize=5,D.numPages=0,D.pageSize=10,D.totalItems=0,D.addFilter=p,D.addRangeFilter=q,D.addSearchField=j,D.changePage=f,D.checkSelectedAggregate=r,D.checkSelectedRangeAggregate=s,D.doSearch=i,D.init=g,D.loadQuery=o,D.obtainAggregateByKey=v,D.openDialog=l,D.removeFilter=t,D.removeRangeFilter=u,D.removeSearchField=k,D.restartSearch=h,D.removeAggregateField=m,D.saveQuery=n,D.showAnalysis=w
}angular.module("guiapp.search").controller("SearchCtrl",a),a.$inject=["elastic","configuration","aggregateBuilder","$modal","queryStorage"]}(),function(){"use strict";function a(a){a.when("/search",{templateUrl:"/partials/search.html",controller:"SearchCtrl",controllerAs:"vm"})}angular.module("guiapp.search").config(a),a.$inject=["$routeProvider"]}(),function(){"use strict";function a(a){function b(b){a.close(b)}var c=this;c.dialog={includeGlobalState:!0,ignoreUnavailable:!1},c.close=b}angular.module("guiapp.snapshot").controller("CreateSnapshotCtrl",a),a.$inject=["$modalInstance"]}(),function(){"use strict";function a(a){function b(b){a.close(b)}var c=this;c.dialog={},c.close=b}angular.module("guiapp.snapshot").controller("CreateSnapshotRepositoryCtrl",a),a.$inject=["$modalInstance"]}(),function(){"use strict";function a(a,b,c){function d(){e()}function e(){b.snapshotRepositories(function(a){n.repositories=a})}function f(a){n.selectedRepository=a}function g(a){b.deleteRepository(a,function(){n.selectedRepository===a&&(n.selectedRepository=""),e()})}function h(){""!==n.selectedRepository&&b.obtainSnapshotStatus(function(a){a.length>0?(n.snapshotsStatus=!0,n.snapshots=a):b.obtainSnapshots(n.selectedRepository,function(a){n.snapshotsStatus=!1,n.snapshots=a})})}function i(a){b.removeSnapshot(n.selectedRepository,a,function(){h()})}function j(a,c){b.removeSnapshot(a,c,function(){h()})}function k(a){b.restoreSnapshot(n.selectedRepository,a,function(){h()})}function l(){var a={backdrop:!0,keyboard:!0,backdropClick:!0,templateUrl:"template/dialog/createsnapshot.html",controller:"CreateSnapshotCtrl",controllerAs:"csVm"},d=c.open(a);d.result.then(function(a){if(a){var c={};if(c.repository=n.selectedRepository,a.name)c.snapshot=a.name;else{var d=moment().format("YYYYMMDDHHmmss");c.snapshot=a.prefix+"-"+d}c.indices=a.indices,c.ignoreUnavailable=a.ignoreUnavailable,c.includeGlobalState=a.includeGlobalState,b.createSnapshot(c,function(){h()})}},function(){})}function m(){var a={backdrop:!0,keyboard:!0,backdropClick:!0,templateUrl:"template/dialog/createsnapshotrepository.html",controller:"CreateSnapshotRepositoryCtrl",controllerAs:"csrVm"},d=c.open(a);d.result.then(function(a){a&&b.createRepository(a,function(){e(),n.selectedRepository=""})},function(){})}var n=this;n.repositories=[],n.selectedRepository="",n.snapshots=[],n.snapshotsStatus=!1,n.listSnapshots=h,n.selectRepository=f,n.deleteRepository=g,n.listrepositories=e,n.removeSnapshot=i,n.removeSnapshotFromRepository=j,n.restoreSnapshot=k,n.openCreateSnapshot=l,n.openCreateSnapshotRepository=m,d(),a.$watch("vm.selectedRepository",function(){h()})}angular.module("guiapp.snapshot").controller("SnapshotCtrl",a),a.$inject=["$scope","elastic","$modal"]}(),function(){"use strict";function a(a){a.when("/tools/snapshots",{templateUrl:"/partials/snapshots.html",controller:"SnapshotCtrl",controllerAs:"vm"})}angular.module("guiapp.snapshot").config(a),a.$inject=["$routeProvider"]}();
//# sourceMappingURL=elasticsearch-gui.min.js.map